<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-2.x-git.min.js" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    
    <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
    <link href='https://cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css' rel='stylesheet' type='text/css'>

    <meta charset="UTF-8">
    <title>Main Page</title>
  </head>

<div class="row column">
<h4 style="margin: 0;" class="text-center" id="request"> </h4>
</div>
<body style="background-color: orange;">
    <div class="columns large-12">
        <button type="button" onclick="testServeur()">Test Serveur</button>
    </div>

    <div class="columns large-12">
        <div class="columns large-3" style="background-color: purple;">
            <a href="index.html">Temperature</a>
        </div>
        <div class="columns large-3" style="background-color: blue;">
            <p>History</p>
        </div>
        <div class="columns large-3" style="background-color: red;">
            <a href="schedule.html">Planning</a>
        </div>
        <div class="columns large-3" style="background-color: green;">
            <button type="button" onclick="setWorking()" id="power_button" >Power</button>
        </div>
    </div>


</footer>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>
<script>
      $(document).foundation();
	</script>
</body>
</html>

<script>
    file = readTextFile("config.txt");
    var address = file.split("\n")[1].split(" ")[1];
    var key = file.split("\n")[0].split(" ")[1];
    getWorking();

    function setWorking() {
        // If the thermostat is currently working, the button have to stop it
        var work = true;
        if(document.getElementById("power_button").innerHTML == "True"){
            work = false;
        }
        console.log("Envoie " + work);
        $.ajax({
            type: 'PUT',
            url: "http://" + address + ":5000/manage/thermostat/" + key,
            dataType: 'json',
            contentType: 'application/json',
            data: JSON.stringify({"working": work}),
            success: function(data){
                data = JSON.parse(data);
                if(data["status"] == "success"){
                    if(work)
                        document.getElementById("power_button").innerHTML = "True";
                    else
                        document.getElementById("power_button").innerHTML = "False";
                }
            },
            error: function(jqXHR, textStatus, errorThrown) {
                if(jqXHR.status == 0){
                    document.getElementById("power_button").innerHTML = "Serveur indisponible";
                }
            }
        });
    }

    function getWorking() {
        $.ajax({
            type: 'GET',
            url: "http://" + address + ":5000/state/thermostat/" + key,
            success: function(data){
                console.log(data);
                data = JSON.parse(data);
                if(data["status"] == "success")
                    document.getElementById("power_button").innerHTML = data["working"];
                else
                    document.getElementById("power_button").innerHTML = data["working"];
            },
            error: function(jqXHR, textStatus, errorThrown) {
                if(jqXHR.status == 0){
                    document.getElementById("power_button").innerHTML = "Serveur indisponible";
                }
                //alert(jqXHR.status);
                //alert(textStatus);
                //alert(errorThrown);
            }
        });
    }

    function testServeur() {
        file = readTextFile("config.txt");
        key = file.split("\n")[0].split(" ")[1];
        console.log("http://" + address + ":5000/data/temperature/" + key);
        $.ajax({
            type: 'GET',
            url: "http://" + address + ":5000/data/temperature/" + key,
            success: function(data){
                data = JSON.parse(data);
                if(data["status"] == "success")
                    document.getElementById("request").innerHTML = data["temperature"];
                else
                    document.getElementById("request").innerHTML = data["description"];
            },
            error: function(jqXHR, textStatus, errorThrown) {
                if(jqXHR.status == 0){
                    document.getElementById("request").innerHTML = "Serveur indisponible";
                }
                //alert(jqXHR.status);
                //alert(textStatus);
                //alert(errorThrown);
            }
        });
    }

  function readTextFile(file) {
    var allText = "";
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function () {
        if(rawFile.readyState === 4) {
            if(rawFile.status === 200 || rawFile.status == 0) {
                allText = rawFile.responseText;
            }
        }
    }
    rawFile.send(null);
    return allText;
  }
</script>

<!--
  <body>
    <h1>Hello World!</h1>
    We are using node <script>document.write(process.versions.node)</script>,
    Chrome <script>document.write(process.versions.chrome)</script>,
    and Electron <script>document.write(process.versions.electron)</script>.

    <h1>The XMLHttpRequest Object</h1>

    <button type="button" onclick="loadDoc()">Request data</button>

    <p id="request"></p>
    <script>
            // Feel free to change or delete any of the code you see in this editor!
            var svg = d3.select("body").append("svg")
              .attr("width", 960)
              .attr("height", 500)
        
            svg.append("text")
              .text("Edit the code below to change me!")
              .attr("y", 200)
              .attr("x", 120)
              .attr("font-size", 36)
              .attr("font-family", "monospace")
        
          </script>
    <script>
      function loadDoc() {
        key = readTextFile("config.txt");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
          document.getElementById("request").innerHTML = this.responseText;
        };
        xhttp.open("GET", "http://localhost:5000/data/temperature/" + key, true);
        xhttp.send();
      }

      function readTextFile(file) {
        var allText = "";
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", file, false);
        rawFile.onreadystatechange = function () {
            if(rawFile.readyState === 4) {
                if(rawFile.status === 200 || rawFile.status == 0) {
                    allText = rawFile.responseText;
                }
            }
        }
        rawFile.send(null);
        return allText;
      }
      </script>
  </body>
    </html>
-->